<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Project:TCR(Awaken)</title>
<style>
  :root{
    --bg: #000;
    --fg: #eee;
    --accent: #b41616;
  }
  *{box-sizing:border-box;}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:"Courier New", monospace;}
  #wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:22px;}
  #game{
    width:100%;max-width:760px;background:rgba(10,10,10,0.55);padding:28px;border-radius:14px;
    border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 40px rgba(0,0,0,0.8), inset 0 0 60px rgba(180,0,0,0.02);
    text-align:center;transition:filter 0.5s, transform 0.3s;
  }
  #question{font-size:1.35rem;min-height:76px;line-height:1.4;margin-bottom:16px;white-space:pre-wrap;}
  #meta{display:flex;gap:14px;justify-content:center;align-items:center;margin-bottom:14px;flex-wrap:wrap;}
  #timer{font-weight:700;color:var(--accent);}
  .btn{background:transparent;color:var(--fg);border:1px solid rgba(255,255,255,0.12);padding:10px 22px;border-radius:10px;cursor:pointer;margin:0 8px;}
  .btn[disabled]{opacity:0.35;cursor:default;}
  .btn:hover:not([disabled]){background:var(--fg);color:var(--bg);}
  #progress{width:100%;height:8px;background:rgba(255,255,255,0.04);border-radius:999px;margin-top:10px;overflow:hidden;}
  #progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#500,#900);transition:width 0.5s linear;}

  /* caret */
  #caret{display:inline-block;width:10px;height:20px;background:var(--fg);margin-left:6px;vertical-align:middle;animation:blink 1s steps(2) infinite;}
  @keyframes blink{50%{opacity:0}}

  /* flash warning */
  .flash{animation:flashAnim 0.15s 2;}
  @keyframes flashAnim{0%{filter:brightness(1)}50%{filter:brightness(1.3)}100%{filter:brightness(1)}}

  /* glitch */
  .glitch{text-shadow:1px 0 var(--accent), -1px 0 #006;animation:glitchMove 0.3s infinite;}
  @keyframes glitchMove{0%{transform:translate(0,0)}50%{transform:translate(1px,-1px)}100%{transform:translate(0,0)}}

  /* smooth collapse for final endings */
  .collapse{animation:collapseHue 4s infinite alternate, collapseShake 0.6s infinite;filter:contrast(180%) saturate(120%) blur(0.3px);}
  @keyframes collapseHue{0%{filter:hue-rotate(0deg) contrast(120%)}100%{filter:hue-rotate(60deg) contrast(180%) blur(0.5px)}}
  @keyframes collapseShake{0%{transform:translate(0,0)}50%{transform:translate(-1px,1px)}100%{transform:translate(1px,-1px)}}

  /* fade-in for ending */
  #ending{margin-top:14px;display:none;font-size:1.03rem;opacity:0;transition:opacity 2s ease-in;}
  #ending.show{display:block;opacity:1;}

  .stats{margin-top:12px;font-size:0.95rem;color:rgba(255,255,255,0.82);}
  #postEndControls{margin-top:14px;}
  small.hint{display:block;margin-top:10px;color:rgba(255,255,255,0.3);}
  footer{margin-top:18px;color:rgba(255,255,255,0.12);font-size:0.85rem;}
  @media(max-width:560px){#question{font-size:1rem;}}
</style>
</head>
<body>
  <div id="wrap">
    <div id="game" aria-live="polite">
      <div id="question">Preparing the afterlife test…</div>

      <div id="meta">
        <div id="timer">Time: --s</div>
        <div id="progress"><i style="width:0%"></i></div>
      </div>

      <div id="controls" style="display:none">
        <button class="btn" id="yesBtn">YES</button>
        <button class="btn" id="noBtn">NO</button>
      </div>

      <div id="ending"></div>
      <div class="stats" id="finalStats" style="display:none"></div>

      <div id="postEndControls" style="display:none;">
        <button class="btn" id="restartBtn">Restart</button>
        <button class="btn" id="menuBtn">Menu</button>
      </div>

      <small class="hint">*Prevent spam to avoid errors. Watch your time.*</small>
      <footer>Q: <span id="totalCount">0</span></footer>
    </div>
  </div>

<script>
/* -------------------
  CONFIG
--------------------*/
const TOTAL_QUESTIONS = 150;
const COLLAPSE_TRIGGER = 12;
const ENDINGS_COUNT = 10;
const TYPE_SPEED = 90; // readable

/* -------------------
  QUESTIONS (example subset)
--------------------*/
const QUESTIONS = {
q1:{q:"Do you recall the first sound you heard in life?",truth:true,nextTrue:"q2",nextFalse:"q3"},
q2:{q:"Would you undo your earliest mistake if you could?",truth:true,nextTrue:"q4",nextFalse:"q5"},
q3:{q:"Do you feel the same fear now as you did then?",truth:false,nextTrue:"q4",nextFalse:"q5"},
q4:{q:"Is love a tether beyond mortality?",truth:true,nextTrue:"q6",nextFalse:"q7"},
// ... continue q5–q140 here ...
q5:{q:"Would you trade your memory for comfort?",truth:false,nextTrue:"q6",nextFalse:"q7"},
q6:{q:"Do you still feel guilt from deeds long past?",truth:true,nextTrue:"q8",nextFalse:"q9"},
q7:{q:"Is fear stronger than hope in your heart?",truth:false,nextTrue:"q8",nextFalse:"q9"},
q8:{q:"Would you forgive someone who cannot forgive you?",truth:true,nextTrue:"q10",nextFalse:"q11"},
q9:{q:"Do you think power corrupts even beyond death?",truth:false,nextTrue:"q10",nextFalse:"q11"},
q10:{q:"Would you follow the same path if given a second life?",truth:true,nextTrue:"q12",nextFalse:"q13"},
q11:{q:"Does silence comfort you more than speech?",truth:false,nextTrue:"q12",nextFalse:"q13"},
q12:{q:"Are regrets heavier than the body you left behind?",truth:true,nextTrue:"q14",nextFalse:"q15"},
q13:{q:"Would you lie to protect someone even now?",truth:false,nextTrue:"q14",nextFalse:"q15"},
q14:{q:"Do you feel your fate is sealed?",truth:true,nextTrue:"q16",nextFalse:"q17"},
q15:{q:"Is memory your only anchor?",truth:false,nextTrue:"q16",nextFalse:"q17"},
q16:{q:"Would you sacrifice yourself for someone unknown?",truth:true,nextTrue:"q18",nextFalse:"q19"},
q17:{q:"Do you hope for a second chance in another life?",truth:false,nextTrue:"q18",nextFalse:"q19"},
q18:{q:"Does love endure past the last heartbeat?",truth:true,nextTrue:"q20",nextFalse:"q21"},
q19:{q:"Do you fear what comes after?",truth:false,nextTrue:"q20",nextFalse:"q21"},
q20:{q:"Is forgiveness attainable when no one asks for it?",truth:true,nextTrue:"q22",nextFalse:"q23"},
q21:{q:"Would you deny your own existence to save another?",truth:false,nextTrue:"q22",nextFalse:"q23"},
q22:{q:"Does hope guide you more than memory?",truth:true,nextTrue:"q24",nextFalse:"q25"},
q23:{q:"Do you feel bound by choices already made?",truth:false,nextTrue:"q24",nextFalse:"q25"},
q24:{q:"Would you cross worlds for a forgotten soul?",truth:true,nextTrue:"q26",nextFalse:"q27"},
q25:{q:"Is doubt stronger than conviction in your thoughts?",truth:false,nextTrue:"q26",nextFalse:"q27"},
q26:{q:"Do you hear whispers of the life you abandoned?",truth:true,nextTrue:"q28",nextFalse:"q29"},
q27:{q:"Would you hide truth to avoid suffering?",truth:false,nextTrue:"q28",nextFalse:"q29"},
q28:{q:"Is there a light that still guides you?",truth:true,nextTrue:"q30",nextFalse:"q31"},
q29:{q:"Do shadows define you more than deeds?",truth:false,nextTrue:"q30",nextFalse:"q31"},
q30:{q:"Would you embrace oblivion if offered?",truth:true,nextTrue:"q32",nextFalse:"q33"},
q31:{q:"Do you seek meaning in silence?",truth:false,nextTrue:"q32",nextFalse:"q33"},
q32:{q:"Is your soul heavier than your regrets?",truth:true,nextTrue:"q34",nextFalse:"q35"},
q33:{q:"Do you fear what no one can see?",truth:false,nextTrue:"q34",nextFalse:"q35"},
q34:{q:"Would you forgive even without apology?",truth:true,nextTrue:"q36",nextFalse:"q37"},
q35:{q:"Is the past more alive than the present?",truth:false,nextTrue:"q36",nextFalse:"q37"},
q36:{q:"Do you welcome the unknown with courage?",truth:true,nextTrue:"q38",nextFalse:"q39"},
q37:{q:"Do you regret more than you rejoice?",truth:false,nextTrue:"q38",nextFalse:"q39"},
q38:{q:"Would you speak truth if it caused pain?",truth:true,nextTrue:"q40",nextFalse:"q41"},
q39:{q:"Do you cling to what cannot be saved?",truth:false,nextTrue:"q40",nextFalse:"q41"},
q40:{q:"Is silence preferable to confession?",truth:true,nextTrue:"q42",nextFalse:"q43"},
q41:{q:"Would you risk loss to gain insight?",truth:false,nextTrue:"q42",nextFalse:"q43"},
q42:{q:"Do you feel guilt even in nothingness?",truth:true,nextTrue:"q44",nextFalse:"q45"},
q43:{q:"Is fear still alive in your veins?",truth:false,nextTrue:"q44",nextFalse:"q45"},
q44:{q:"Would you guide another lost soul?",truth:true,nextTrue:"q46",nextFalse:"q47"},
q45:{q:"Do you feel the weight of unspoken words?",truth:false,nextTrue:"q46",nextFalse:"q47"},
q46:{q:"Is hope eternal even after the body dies?",truth:true,nextTrue:"q48",nextFalse:"q49"},
q47:{q:"Do you seek meaning in regret?",truth:false,nextTrue:"q48",nextFalse:"q49"},
q48:{q:"Would you erase your past if given chance?",truth:true,nextTrue:"q50",nextFalse:"q51"},
q49:{q:"Is solitude a friend or foe?",truth:false,nextTrue:"q50",nextFalse:"q51"},
q50:{q:"Do you feel life lingers within memory?",truth:true,nextTrue:"q52",nextFalse:"q53"},
q51:{q:"Would you hide from truth even now?",truth:false,nextTrue:"q52",nextFalse:"q53"},
q52:{q:"Do you seek light in eternal night?",truth:true,nextTrue:"q54",nextFalse:"q55"},
q53:{q:"Is despair stronger than resolve?",truth:false,nextTrue:"q54",nextFalse:"q55"},
q54:{q:"Would you risk oblivion for clarity?",truth:true,nextTrue:"q56",nextFalse:"q57"},
q55:{q:"Do you remember what you lost most?",truth:false,nextTrue:"q56",nextFalse:"q57"},
q56:{q:"Is forgiveness your final gift?",truth:true,nextTrue:"q58",nextFalse:"q59"},
q57:{q:"Do you fear the emptiness ahead?",truth:false,nextTrue:"q58",nextFalse:"q59"},
q58:{q:"Would you follow a path unseen?",truth:true,nextTrue:"q60",nextFalse:"q61"},
q59:{q:"Do you doubt your own desires?",truth:false,nextTrue:"q60",nextFalse:"q61"},
q60:{q:"Is love the anchor of your choices?",truth:true,nextTrue:"q62",nextFalse:"q63"},
q61:{q:"Would you surrender truth to peace?",truth:false,nextTrue:"q62",nextFalse:"q63"},
q62:{q:"Do you see regret as a teacher?",truth:true,nextTrue:"q64",nextFalse:"q65"},
q63:{q:"Does fear overshadow your understanding?",truth:false,nextTrue:"q64",nextFalse:"q65"},
q64:{q:"Would you face oblivion willingly?",truth:true,nextTrue:"q66",nextFalse:"q67"},
q65:{q:"Do you still remember your first joy?",truth:false,nextTrue:"q66",nextFalse:"q67"},
q66:{q:"Is truth stronger than survival?",truth:true,nextTrue:"q68",nextFalse:"q69"},
q67:{q:"Would you hide from your own shadow?",truth:false,nextTrue:"q68",nextFalse:"q69"},
q68:{q:"Do you feel guilt as a companion?",truth:true,nextTrue:"q70",nextFalse:"q71"},
q69:{q:"Is hope fading in your consciousness?",truth:false,nextTrue:"q70",nextFalse:"q71"},
q70:{q:"Would you guide another to understanding?",truth:true,nextTrue:"q72",nextFalse:"q73"},
q71:{q:"Do you feel lost even in light?",truth:false,nextTrue:"q72",nextFalse:"q73"},
q72:{q:"Is your past a shadow you cannot leave?",truth:true,nextTrue:"q74",nextFalse:"q75"},
q73:{q:"Would you deny your own guidance?",truth:false,nextTrue:"q74",nextFalse:"q75"},
q74:{q:"Do you seek redemption in quiet?",truth:true,nextTrue:"q76",nextFalse:"q77"},
q75:{q:"Is silence louder than memory?",truth:false,nextTrue:"q76",nextFalse:"q77"},
q76:{q:"Would you take one step into nothingness?",truth:true,nextTrue:"q78",nextFalse:"q79"},
q77:{q:"Do you fear the unseen hand of fate?",truth:false,nextTrue:"q78",nextFalse:"q79"},
q78:{q:"Is truth a burden or a gift?",truth:true,nextTrue:"q80",nextFalse:"q81"},
q79:{q:"Would you embrace shadow for understanding?",truth:false,nextTrue:"q80",nextFalse:"q81"},
q80:{q:"Do you feel the presence of those you’ve wronged?",truth:true,nextTrue:"q82",nextFalse:"q83"},
q81:{q:"Would you trade safety for clarity?",truth:false,nextTrue:"q82",nextFalse:"q83"},
q82:{q:"Is the soul heavier than the body it left behind?",truth:true,nextTrue:"q84",nextFalse:"q85"},
q83:{q:"Do you dread the moments between memories?",truth:false,nextTrue:"q84",nextFalse:"q85"},
q84:{q:"Would you speak truth even if it isolates you?",truth:true,nextTrue:"q86",nextFalse:"q87"},
q85:{q:"Do shadows define your choices?",truth:false,nextTrue:"q86",nextFalse:"q87"},
q86:{q:"Do you feel eternity pressing on your shoulders?",truth:true,nextTrue:"q88",nextFalse:"q89"},
q87:{q:"Would you conceal knowledge to protect another?",truth:false,nextTrue:"q88",nextFalse:"q89"},
q88:{q:"Is forgiveness the path forward?",truth:true,nextTrue:"q90",nextFalse:"q91"},
q89:{q:"Do you cling to a past that no longer exists?",truth:false,nextTrue:"q90",nextFalse:"q91"},
q90:{q:"Would you embrace your mistakes as lessons?",truth:true,nextTrue:"q92",nextFalse:"q93"},
q91:{q:"Is regret a constant companion?",truth:false,nextTrue:"q92",nextFalse:"q93"},
q92:{q:"Do you accept what cannot be changed?",truth:true,nextTrue:"q94",nextFalse:"q95"},
q93:{q:"Would you hide from truths to remain comfortable?",truth:false,nextTrue:"q94",nextFalse:"q95"},
q94:{q:"Is your heart heavier than your body?",truth:true,nextTrue:"q96",nextFalse:"q97"},
q95:{q:"Do you fear solitude more than death?",truth:false,nextTrue:"q96",nextFalse:"q97"},
q96:{q:"Would you risk pain for knowledge?",truth:true,nextTrue:"q98",nextFalse:"q99"},
q97:{q:"Do you feel lost even when guided?",truth:false,nextTrue:"q98",nextFalse:"q99"},
q98:{q:"Is hope still alive within you?",truth:true,nextTrue:"q100",nextFalse:"q101"},
q99:{q:"Would you sacrifice comfort for clarity?",truth:false,nextTrue:"q100",nextFalse:"q101"},
q100:{q:"Do you feel your actions echo beyond life?",truth:true,nextTrue:"q102",nextFalse:"q103"},
q101:{q:"Is silence a balm or a curse?",truth:false,nextTrue:"q102",nextFalse:"q103"},
q102:{q:"Would you forgive without understanding?",truth:true,nextTrue:"q104",nextFalse:"q105"},
q103:{q:"Do you fear what cannot be seen?",truth:false,nextTrue:"q104",nextFalse:"q105"},
q104:{q:"Is truth heavier than comfort?",truth:true,nextTrue:"q106",nextFalse:"q107"},
q105:{q:"Would you surrender joy for safety?",truth:false,nextTrue:"q106",nextFalse:"q107"},
q106:{q:"Do you seek light even in shadow?",truth:true,nextTrue:"q108",nextFalse:"q109"},
q107:{q:"Is fear your truest companion?",truth:false,nextTrue:"q108",nextFalse:"q109"},
q108:{q:"Would you stand alone against eternity?",truth:true,nextTrue:"q110",nextFalse:"q111"},
q109:{q:"Do you feel time slipping through your grasp?",truth:false,nextTrue:"q110",nextFalse:"q111"},
q110:{q:"Is memory the anchor of your soul?",truth:true,nextTrue:"q112",nextFalse:"q113"},
q111:{q:"Would you abandon hope for certainty?",truth:false,nextTrue:"q112",nextFalse:"q113"},
q112:{q:"Do you feel a presence guiding your steps?",truth:true,nextTrue:"q114",nextFalse:"q115"},
q113:{q:"Is regret a teacher you cannot escape?",truth:false,nextTrue:"q114",nextFalse:"q115"},
q114:{q:"Would you offer forgiveness unasked?",truth:true,nextTrue:"q116",nextFalse:"q117"},
q115:{q:"Do you fear what is inevitable?",truth:false,nextTrue:"q116",nextFalse:"q117"},
q116:{q:"Is courage stronger than memory?",truth:true,nextTrue:"q118",nextFalse:"q119"},
q117:{q:"Do you cling to fragments of the past?",truth:false,nextTrue:"q118",nextFalse:"q119"},
q118:{q:"Would you choose truth over comfort?",truth:true,nextTrue:"q120",nextFalse:"q121"},
q119:{q:"Do shadows feel familiar to you?",truth:false,nextTrue:"q120",nextFalse:"q121"},
q120:{q:"Do you seek meaning beyond death?",truth:true,nextTrue:"q122",nextFalse:"q123"},
q121:{q:"Would you hide from knowledge to remain safe?",truth:false,nextTrue:"q122",nextFalse:"q123"},
q122:{q:"Is love eternal in your heart?",truth:true,nextTrue:"q124",nextFalse:"q125"},
q123:{q:"Do you fear emptiness more than failure?",truth:false,nextTrue:"q124",nextFalse:"q125"},
q124:{q:"Would you embrace loss for understanding?",truth:true,nextTrue:"q126",nextFalse:"q127"},
q125:{q:"Do you dwell on mistakes more than victories?",truth:false,nextTrue:"q126",nextFalse:"q127"},
q126:{q:"Is hope a light that cannot be extinguished?",truth:true,nextTrue:"q128",nextFalse:"q129"},
q127:{q:"Do you feel tethered to what is gone?",truth:false,nextTrue:"q128",nextFalse:"q129"},
q128:{q:"Would you sacrifice everything for another soul?",truth:true,nextTrue:"q130",nextFalse:"q131"},
q129:{q:"Do you doubt your own resolve?",truth:false,nextTrue:"q130",nextFalse:"q131"},
q130:{q:"Is truth the only guide you trust?",truth:true,nextTrue:"q132",nextFalse:"q133"},
q131:{q:"Would you hide from your destiny?",truth:false,nextTrue:"q132",nextFalse:"q133"},
q132:{q:"Do you feel the weight of eternity pressing in?",truth:true,nextTrue:"q134",nextFalse:"q135"},
q133:{q:"Is silence more telling than speech?",truth:false,nextTrue:"q134",nextFalse:"q135"},
q134:{q:"Would you embrace the void willingly?",truth:true,nextTrue:"q136",nextFalse:"q137"},
q135:{q:"Do you cling to light that may not exist?",truth:false,nextTrue:"q136",nextFalse:"q137"},
q136:{q:"Is forgiveness a release or a burden?",truth:true,nextTrue:"q138",nextFalse:"q139"},
q137:{q:"Would you abandon understanding for comfort?",truth:false,nextTrue:"q138",nextFalse:"q139"},
q138:{q:"Do you feel eternity within your grasp?",truth:true,nextTrue:"q140",nextFalse:"q141"},
q139:{q:"Do shadows linger where you do not expect?",truth:false,nextTrue:"q140",nextFalse:"q141"},
q140:{q:"Are you ready to face the final reckoning?",truth:true,nextTrue:"q141",nextFalse:"q142"},
q141:{q:"Do you welcome the void within?",truth:true,nextTrue:"q142",nextFalse:"q143"},
q142:{q:"Is silence the only truth remaining?",truth:true,nextTrue:"q144",nextFalse:"q145"},
q143:{q:"Do you feel the chains of what was undone?",truth:false,nextTrue:"q144",nextFalse:"q145"},
q144:{end:true,message:"Darkness folds in softly. Your name ceases to echo."},
q145:{end:true,message:"A thin light nibbles at your edges. Memory loosens its grip."},
q146:{end:true,message:"The loop tightens. You wake again, unsure if you have ever lived."},
q147:{end:true,message:"Quiet absolves you. There is no judgement, only sleep."},
q148:{end:true,message:"You descend into a vacant hush. Even regret thins to dust."},
q149:{end:true,message:"A door opens. Beyond, an unfamiliar life waits with blank eyes."},
q150:{end:true,message:"Heat fades into shadow. For a moment you feel nothing at all."},
};

/* -------------------
  STATE & DOM
--------------------*/
const STATE = { currentKey:'q1', visited:0, truths:0, lies:0 };
const questionEl = document.getElementById('question');
const timerEl = document.getElementById('timer');
const controlsEl = document.getElementById('controls');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const progressBar = document.querySelector('#progress > i');
const endingEl = document.getElementById('ending');
const statsEl = document.getElementById('finalStats');
const postEndControls = document.getElementById('postEndControls');
const restartBtn = document.getElementById('restartBtn');
const menuBtn = document.getElementById('menuBtn');

let typing=false;
let timerVal=0;
let timerInterval=null;

/* -------------------
  TYPEWRITER
--------------------*/
function typewriter(text){
  return new Promise(resolve=>{
    typing=true;
    controlsEl.style.display='none';
    questionEl.classList.remove('glitch');
    questionEl.textContent='';
    const caret=document.createElement('span'); caret.id='caret';
    let i=0;
    function run(){
      if(i<text.length){
        questionEl.textContent+=text[i++];
        if(!questionEl.contains(caret)) questionEl.appendChild(caret);
        setTimeout(run, TYPE_SPEED);
      } else {
        if(questionEl.contains(caret)) questionEl.removeChild(caret);
        typing=false;
        controlsEl.style.display='block';
        resolve();
      }
    }
    run();
    });
}

/* -------------------
  NAVIGATION
--------------------*/
function startIntro(){
  const intro = "You awaken between breaths. Answer simply: yes or no.";
  typewriter(intro).then(()=> goToNode('q1'));
}

function goToNode(key){
  clearInterval(timerInterval);
  const node = QUESTIONS[key];
  if(!node){ endGame("The test falters. Silence swallows the corridor."); return; }
  STATE.currentKey = key;
  STATE.visited++;
  if(node.end){ renderEnding(node.message); return; }
  const remainingEstimate = TOTAL_QUESTIONS - STATE.visited;
  if(remainingEstimate <= COLLAPSE_TRIGGER){
    setTimeout(()=> document.getElementById('game').classList.add('collapse'), 700);
  }
  typewriter(node.q).then(()=> startTimerForNode());
  updateProgress();
}

function startTimerForNode(){
  timerVal = 7 + (Math.floor(Math.random()*4));
  timerEl.textContent = `Time: ${timerVal}s`;
  questionEl.classList.remove('flash');
  timerInterval = setInterval(() => {
    timerVal--;
    timerEl.textContent = `Time: ${timerVal}s`;
    if(timerVal === 3){
      questionEl.classList.add('flash');
      setTimeout(()=> questionEl.classList.remove('flash'), 600);
    }
    if(timerVal <= 0){
      clearInterval(timerInterval);
      handleAnswer(false,true);
    }
  },1000);
}

function handleAnswer(choice,auto=false){
  if(typing) return;
  clearInterval(timerInterval);
  const node = QUESTIONS[STATE.currentKey];
  if(!node) return;
  const isTruth = (choice===node.truth);
  if(isTruth){ STATE.truths++; questionEl.textContent="Truth accepted."; } 
  else { STATE.lies++; questionEl.textContent="Inconsistency noted."; questionEl.classList.add('glitch'); }
  setTimeout(()=>{
    const nextKey = choice? node.nextTrue: node.nextFalse;
    if(QUESTIONS[nextKey]) goToNode(nextKey);
    else { 
      const endingIndex = TOTAL_QUESTIONS - ENDINGS_COUNT + ((STATE.truths+STATE.lies)%ENDINGS_COUNT);
      goToNode(`q${endingIndex}`);
    }
  },720);
}

function updateProgress(){
  const pct = Math.min(100, Math.round((STATE.visited/TOTAL_QUESTIONS)*100));
  progressBar.style.width = pct+'%';
}

function renderEnding(msg){
  clearInterval(timerInterval);
  controlsEl.style.display = 'none';
  timerEl.textContent = "";
  questionEl.textContent = "Final Determination:";
  endingEl.textContent = msg;
  endingEl.classList.add('show');
  document.getElementById('game').classList.add('collapse');
  setTimeout(()=>{
    statsEl.style.display='block';
    const totalAnswered = STATE.truths + STATE.lies;
    const truthPct = totalAnswered? Math.round((STATE.truths/totalAnswered)*100):0;
    const liePct = totalAnswered? Math.round((STATE.lies/totalAnswered)*100):0;
    statsEl.innerHTML = `
      <strong>Scoreboard</strong><br>
      Questions reached: ${STATE.visited} / ${TOTAL_QUESTIONS}<br>
      Truthful answers: ${STATE.truths} (${truthPct}% )<br>
      Inconsistencies (lies/hesitations): ${STATE.lies} (${liePct}% )
    `;
  },1200);
}

function endGame(msg){ renderEnding(msg || "The test concluded unexpectedly."); }

/* -------------------
  Events
--------------------*/
yesBtn.addEventListener('click',()=>handleAnswer(true));
noBtn.addEventListener('click',()=>handleAnswer(false));
document.addEventListener('keydown',e=>{
  if(typing) return;
  if(e.key==='y'||e.key==='Y'||e.key==='Enter') handleAnswer(true);
  if(e.key==='n'||e.key==='N'||e.key==='Escape') handleAnswer(false);
});

/* -------------------
  Start game
--------------------*/
controlsEl.style.display='none';
document.getElementById('totalCount').textContent=TOTAL_QUESTIONS;
setTimeout(startIntro,800);
</script>

  <footer style="
    position: fixed;
    bottom: 0;
    width: 100%;
    text-align: center;
    padding: 8px;
    background-color: #141414;
    font-size: 14px;
    color: #666;
    border-top: 1px solid #ccc;
  ">
    © 2025 The Choice Room. All rights reserved.
  </footer>

</body>
</html>